---
layout: page
title: Запуск Selenium-тестов в браузере Opera
joomla_id: 133
joomla_url: operachromiumdriver
date: 2015-05-19 07:52:23.000000000 +03:00
author: Алексей Баранцев
excerpt: |-
  <p><img src="images/articles/barancev/operachromium.jpg" border="0" width="400" height="245" style="float: right;" /></p>
  <p>{tortags,133,1}</p>
  <p>Существует две принципиально разные версии браузера Opera, построенные на разных движках:</p>
  <ul>
  <li>"старая" Opera (версии до 12), использующая оригинальный движок Presto, разработанный компанией Opera Software,</li>
  <li>"новая" Opera (версии 15 и больше), построенная на основе браузера Chromium, то есть использующая движок Blink.</li>
  </ul>
  <p>Соответственно, и для запуска Selenium-тестов в этих разных версиях используются совершенно разные механизмы.</p>
  <p>Маловероятно, что кому-то сейчас ещё требуется тестировать веб-приложения в старых версиях браузера Opera, поэтому в этой статье описывается только способ запуска тестов в новых версиях Opera.</p>
category: Статьи
---
<p><img src="images/articles/barancev/operachromium.jpg" border="0" width="400" height="245" style="float: right;" /></p>
<p>{tortags,133,1}</p>
<p>Существует две принципиально разные версии браузера Opera, построенные на разных движках:</p>
<ul>
<li>"старая" Opera (версии до 12), использующая оригинальный движок Presto, разработанный компанией Opera Software,</li>
<li>"новая" Opera (версии 15 и больше), построенная на основе браузера Chromium, то есть использующая движок Blink.</li>
</ul>
<p>Соответственно, и для запуска Selenium-тестов в этих разных версиях используются совершенно разные механизмы.</p>
<p>Маловероятно, что кому-то сейчас ещё требуется тестировать веб-приложения в старых версиях браузера Opera, поэтому в этой статье описывается только способ запуска тестов в новых версиях Opera.</p><p>Поскольку новая Opera фактически является надстройкой над браузером Chromium, было бы логично предположить, что для запуска тестов можно использовать утилиту chromedriver и интерфейсный класс ChromeDriver.</p>
<p>Единственное затруднение, которое возникает -- это неспособность драйвера автоматически определить расположение исполняемого файла браузера, поскольку драйвер нацелен на поиск исполняемого файла браузера Chrome.</p>
<p>Но ведь можно явно указать путь к исполняемому файлу при инициализации драйвера:</p>
<pre>ChromeOptions options = new ChromeOptions();<br />options.setBinary("c:\\Program Files (x86)\\Opera\\29.0.1795.47\\opera.exe");<br />ChromeDriver driver = new ChromeDriver(options);</pre>
<p>Увы, несмотря на то, что браузер запускается -- драйвер не может им управлять, инициализация завершается с исключением...</p>
<p>Причина, вероятно, в том, что с некоторых пор в chromedriver добавлена функция контроля версий -- драйвер отказывается работать с любыми версиями браузера, кроме "официально поддерживаемых". В том числе под раздачу попали Opera, Yandex-браузер и прочие надстройки над Chromium -- драйвер отвергает их как несовместимые.</p>
<p>К счастью, разработчики Opera выпустили альтернативную версию этой вспомогательной утилиты, которая называется, как несложно догадаться, operadriver.</p>
<p>Скачать её можно отсюда: <a href="https://github.com/operasoftware/operachromiumdriver/releases">https://github.com/operasoftware/operachromiumdriver/releases</a></p>
<p>Выбираете архив, соответствующий вашей платформе и битности браузера, загружаете, распаковываете -- внутри находится один единственный исполняемый файл, он-то нам и нужен.</p>
<p>Теперь при инициализации ChromeDriver вместо пути к браузеру нужно указать путь к этой утилите, извлечённой из загруженного архива (а браузер она уже сама найдёт, если он установлен в стандартное место):</p>
<pre>ChromeDriverService service = new ChromeDriverService.Builder()<br /> .usingDriverExecutable(new File("C:\\Tools\\operadriver.exe")).build();<br />ChromeDriver driver = new ChromeDriver(service);<br />driver.get("http://selenium2.ru/");<br />driver.quit();</pre>
<p>И чтобы ещё немного сократить количество кода, в Selenium начиная с версии 2.45 добавлен новый интерфейсный класс OperaDriver, который сам умеет находить исполняемый файл operadriver, так что запуск Opera становится таким же простым, как запуск любого другого браузера:</p>
<pre>OperaDriver driver = new OperaDriver();<br />driver.get("http://selenium2.ru/");<br />driver.quit();</pre>
<p>Правда, для этого нужно исполняемый файл operadriver поместить в какую-нибудь директорию, где операционная система сможет его найти, то есть в любую директорию, упомянутую в переменной окружения PATH. Пользователи операционной системы Windows могут положить этот файл, например, в директорию C:\windows\system32</p>
<p>И ещё будьте внимательны -- новый OperaDriver находится в пакете org.openqa.selenium.opera, а есть ещё старый класс с таким же названием, который находится в пакете com.opera.core.systems, он предназначен для работы со "старой" Opera, построенной на движке Presto.</p>
