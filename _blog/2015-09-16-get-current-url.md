---
layout: page
title: Изменение семантики операции getCurrentUrl в Selenium
joomla_id: 157
joomla_url: get-current-url
date: 2015-09-16 06:29:24.000000000 +03:00
author: Алексей Баранцев
excerpt: |-
  <p><img src="images/blog/get_current_url.png" border="0" alt="" style="font-size: 12.16px; line-height: 1.3em;" /></p>
  <p>В следующей версии Selenium произойдёт изменение, которое нарушает обратную совместимость, но увеличивает совместимость со стандартом W3C WebDriver: <strong>операция getCurrentUrl будет возвращать адрес, который пользователь видит в адресной строке браузера, а не адрес текущего фрейма</strong>.</p>
  <p>Соответственно, э<span>то изменение затронет тех, кто активно работает с фреймами, в частности, проверяет их адреса.</span></p>
  <p>Дальше подробности для тех, кто забеспокоился :)</p>
  <p><strong>Почему при разработке стандарта было принято решение об изменении семантики этой операции?</strong></p>
  <p>Причин целых две:</p>
  <p>1) "Бытовая": инструмент должен возвращать тот адрес, который видит пользователь. Ранее, руководствуясь той же самой логикой, было принято решение о том, что операция getTitle должна возвращать не заголовок текущего фрейма, а заголовок фрейма верхнего уровня, тот самый, который пользователь видит в названии окна или вкладки браузера.</p>
  <p>2) "Техническая": получить адрес текущего фрейма можно и через JavaScript, а вот получить адрес контекста верхнего уровня через JavaScript невозможно из соображений безопасности -- браузер не разрешает выходить за пределы текущего контекста, если при этом нарушается знаменитое правило <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#origin">same origin policy</a>. Поэтому решили, что операция для получения адреса контекста верхнего уровня является более важной.</p>
  <p><strong>Что надо сделать, чтобы заранее подготовиться к выходу следующей версии Selenium?</strong></p>
  <ul>
  <li>найти все места, где используется операция getCurrentUrl</li>
  <li>если там никаких фреймов нет -- значит вы в полной безопасности</li>
  <li>если эта операция используется для получения адреса текущего фрейма -- надо вместо неё использовать вот такой вспомогательный метод:</li>
  </ul>
  <pre>public getCurrentFrameUrl(WebDriver driver) {<br />  return ((JavascriptExecutor) driver).executeScript("return window.location.href").toString();<br />}</pre>
category: Блог
---
<p><img src="images/blog/get_current_url.png" border="0" alt="" style="font-size: 12.16px; line-height: 1.3em;" /></p>
<p>В следующей версии Selenium произойдёт изменение, которое нарушает обратную совместимость, но увеличивает совместимость со стандартом W3C WebDriver: <strong>операция getCurrentUrl будет возвращать адрес, который пользователь видит в адресной строке браузера, а не адрес текущего фрейма</strong>.</p>
<p>Соответственно, э<span>то изменение затронет тех, кто активно работает с фреймами, в частности, проверяет их адреса.</span></p>
<p>Дальше подробности для тех, кто забеспокоился :)</p>
<p><strong>Почему при разработке стандарта было принято решение об изменении семантики этой операции?</strong></p>
<p>Причин целых две:</p>
<p>1) "Бытовая": инструмент должен возвращать тот адрес, который видит пользователь. Ранее, руководствуясь той же самой логикой, было принято решение о том, что операция getTitle должна возвращать не заголовок текущего фрейма, а заголовок фрейма верхнего уровня, тот самый, который пользователь видит в названии окна или вкладки браузера.</p>
<p>2) "Техническая": получить адрес текущего фрейма можно и через JavaScript, а вот получить адрес контекста верхнего уровня через JavaScript невозможно из соображений безопасности -- браузер не разрешает выходить за пределы текущего контекста, если при этом нарушается знаменитое правило <a href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#origin">same origin policy</a>. Поэтому решили, что операция для получения адреса контекста верхнего уровня является более важной.</p>
<p><strong>Что надо сделать, чтобы заранее подготовиться к выходу следующей версии Selenium?</strong></p>
<ul>
<li>найти все места, где используется операция getCurrentUrl</li>
<li>если там никаких фреймов нет -- значит вы в полной безопасности</li>
<li>если эта операция используется для получения адреса текущего фрейма -- надо вместо неё использовать вот такой вспомогательный метод:</li>
</ul>
<pre>public getCurrentFrameUrl(WebDriver driver) {<br />  return ((JavascriptExecutor) driver).executeScript("return window.location.href").toString();<br />}</pre>
