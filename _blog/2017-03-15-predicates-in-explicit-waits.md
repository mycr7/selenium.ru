---
layout: page
title: Почему в 3.3.1 перестали работать предикаты в явных ожиданиях?
redirect_from: /blog/187-predicates-in-explicit-waits.html
date: 2017-03-15 13:32:12.000000000 +03:00
author: Алексей Баранцев
image:
  title: /images/blog/broken_wait.jpg
  thumb: /images/blog/broken_wait.jpg
teaser: "После обновления Java-библиотеки Selenium до версии 3.3.1 пользователи, у которых были
  созданы свои собственные условия для явных ожиданий, заметили, что они перестали
  работать. Что произошло? И, главное, что делать? Обновите
  в своём проекте зависимость от Guava до версии 21 и проблема должна исчезнуть."
category: Блог
---
<p>После обновления Java-библиотеки Selenium до версии 3.3.1 пользователи, у которых были созданы свои собственные условия для явных ожиданий, заметили, что они перестали работать.</p>
<p>Что произошло? И, главное, что делать?</p>
<p><strong>Обновите в своём проекте зависимость от Guava до версии 21 и проблема должна исчезнуть.</strong></p>
<p><em>TL;DR</em></p>

<p>И всё таки, что же случилось?</p>
<p>Java-библиотека Selenium начиная с версии 3.0 работает только в Java 8. Это позволяет разработчикам использовать новые возможности, которые появились в Java 8.</p>
<p>В частности, было бы логично, если бы в функцию WebDriverWait.until(...) можно было передавать лямбда-выражения.</p>
<p>Исторически так сложилось, что эта функция принимала на вход значения классов <a href="https://github.com/google/guava/wiki/FunctionalExplained" rel="alternate">Function, Predicate или Supplier из библиотеки Guava</a>. Для того, чтобы написать "самодельное" ожидание, нужно было реализовать один из этих интерфейсов. Поэтому мы не могли просто взять и изменить функцию until, чтобы она использовала для параметров одноимённые классы из Java 8 -- все уже написанные ожидания перестали бы работать.</p>
<p>К счастью, в версии Guava 21 перечисленные классы стали наследоваться от соответствующих <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/package-summary.html" rel="alternate">стандартных классов Java 8</a>.</p>
<p>Поэтому мы <a href="https://github.com/SeleniumHQ/selenium/commit/b2aa9fd534f7afbcba319231bb4bce85f825ef09" rel="alternate">поменяли интерфейс функции until</a>, теперь она принимает значения классов Function, Predicate или Supplier из стандартной библиотеки Java.</p>
<p>Если у вас уже есть самодельные условия ожидания, которые реализуют, скажем, Predicate из Guava, и вы используете старую версию Guava -- вы не сможете передать такое условие в функцию until, типы не совместимы.</p>
<p>Но после обновления Guava до версии 21 эта несовместимость пропадает. Вы можете продолжать использовать написанные ранее ожидания, а также делать новые без использования Guava.</p>
